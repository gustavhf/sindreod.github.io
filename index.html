<!DOCTYPE html>
<html>
<head> 
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
   integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
   crossorigin=""/>

    <!-- Lib libraries -->
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
   integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
   crossorigin=""></script> <!-- Leaflet osv basemap -->

    <script src="js/leaflet.ajax.min.js"></script> <!-- Read external GeoJSON-files -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script> <!-- jQuery API -->
    <script src="js/leafletExtension.js"></script> <!-- Leaflet extension -->
    <link rel="stylesheet" href="index.css"/>
    <link rel="icon" href="pika.png">
</head>

<body>
<!-- Side navigation -->
<div class="sidenav">
    <img src="PokeGIS.png" alt="PokÃ©GIS">
    <div id="Operations">
        <ul>
            <li>
                <div id="buffer" class="dropDown">Buffer</div>
                <div class="dropDownContent">
                    Layer:
                    <select name="bufferSelect" class="dropDownLayers">
                        <!-- Options here -->
                    </select>
                    <br>Distance:
                    <input id="bufferDistance" class="sidenavText" type="text" placeholder="km"></input>
                    <button id="createBuffer">Create buffer</button>
                </div>
            </li>
            <li>
                <div id="Union" class="dropDown">Union</div>
                <div class="dropDownContent">Dropdown</div>
            </li>
            <li>
                <div id="Intersection" class="dropDown">Intersection</div>
                <div class="dropDownContent">Dropdown</div>

            </li>
            <li>
                <div id="Difference" class="dropDown">Difference</div>
                <div class="dropDownContent">Dropdown</div>

            </li>
            <li>
                <div id="Filter" class="dropDown">Filter</div>
                <div class="dropDownContent">Dropdown</div>
            </li>



        </ul>
    </div>

</div>

<!-- Page content -->
<div class="main">
    <div id="map"></div>
</div>
 <script type="text/javascript">

     // Set background map
     var map = L.map('map', {
         minZoom: 11,
         maxZoom: 20
     }).setView([63.366288, 10.4308315]);

     //Set bounds for startup
     var startBounds = L.latLngBounds([
         [63.381063, 10.393066],
         [63.351513, 10.468597]
     ]);

     //Set bounds for panning
     var worldBounds = L.latLngBounds([
         [63.430860, 10.055237],
         [63.171095, 10.784454]
     ]);

     //Start and panning bounds applied
     map.fitBounds(startBounds);
     map.on('drag', function() {
         map.panInsideBounds(worldBounds, { animate: true });
     });

     //Add baseMap layer to map and display it
     var backGroundLayer = L.layerGroup().addTo(map);

     //Add a region layer to map
     var politicalLayer = L.layerGroup();

     //Make a region dictionary and collect in featureGroups
     var regions = {};
     regionNames = ["Hoenn", "Sinnoh", "Orange Islands", "Orre", "Johto", "Kanto", "Sevii Islands", "Fiore", "Oblivia", "Almia", "Holon", "Unova", "Distant land", "Rest"];
     for (var i = 0; i < regionNames.length; i++) {
         regions[regionNames[i]] = L.featureGroup();
         politicalLayer.addLayer(regions[regionNames[i]]);
     }

     //Make a layer for all cities on the map
     var cityLayer = L.layerGroup();

     //Add hightlighting on hover
     politicalLayer.eachLayer(function (layer) {
        layer.on({
            mouseover: highlightFeature,
            mouseout: resetHighlight
        });
     });

     function highlightFeature(e) {
         var layer = e.target;
         layer.setStyle({
             weight: 5
         });
     }

     function resetHighlight(e) {
         var layer = e.target;
         layer.setStyle({
             weight: 1
         })
     }

     // Load data
     jQuery.getJSON("data/water2.geojson" , function (json) {
         L.geoJSON(json, {
             style: function (feature) {
                 return {"fill":true,
                     "fillColor": "#00bfff",
                     "fillOpacity": 1,
                     "stroke": false
                 }},
             onEachFeature: addBackGroundData
         }).bindPopup(function (layer) {
             return "This is a water"
         }).addTo(map);
     });

     jQuery.getJSON("data/land2.geojson" , function (json) {
         L.geoJSON(json, {
             style: function (feature) {
                 return {"fill": true,
                     "fillColor": "#1ec595",
                     "fillOpacity": 1,
                     "stroke": true,
                     "color": "#000000",
                     "weight": 1
                 }
             },
             onEachFeature: addBackGroundData
         }).bindPopup(function (layer) {
             return "Part of: " + layer.feature.properties.description;
         }).addTo(map);
     });

     jQuery.getJSON("data/Ocean.geojson" , function (json) {
         L.geoJSON(json, {
             style: function (feature) {
                 return {"fill": true,
                     "fillColor": "#00bcdc",
                     "fillOpacity": 1,
                     "stroke": false
                 };
             },
             onEachFeature: addBackGroundData
         }).bindPopup(function (layer) {
             return "The vast ocean"
         }).addTo(map);
     });


     //Load regions data and apply styling for each region
     jQuery.getJSON("data/political.geojson", function (json) {
         L.geoJSON(json, {
             style: function (feature) {
                 switch (feature.properties.description) {
                     case "Kanto":
                         return {
                             "fill": true,
                             "fillOpacity": 1,
                             "stroke": true,
                             "color": "#000000",
                             "weight": 1,
                             "fillColor": "#ff0000"
                         };
                     case "Johto":
                         return {
                             "fill": true,
                             "fillOpacity": 1,
                             "stroke": true,
                             "color": "#000000",
                             "weight": 1,
                             "fillColor": "#ffff00"
                         };
                     case "Holon":
                         return {
                             "fill": true,
                             "fillOpacity": 1,
                             "stroke": true,
                             "color": "#000000",
                             "weight": 1,
                             "fillColor": "#ff00ff"
                         };
                     case "Sinnoh":
                         return {
                             "fill": true,
                             "fillOpacity": 1,
                             "stroke": true,
                             "color": "#000000",
                             "weight": 1,
                             "fillColor": "#ffffff"
                         };
                     case "Hoenn":
                         return {
                             "fill": true,
                             "fillOpacity": 1,
                             "stroke": true,
                             "color": "#000000",
                             "weight": 1,
                             "fillColor": "#ff0000"
                         };
                     case "Orange Islands":
                         return {
                             "fill": true,
                             "fillOpacity": 1,
                             "stroke": true,
                             "color": "#000000",
                             "weight": 1,
                             "fillColor": "#ff7700"
                         };
                     case "Sevii Islands":
                         return {
                             "fill": true,
                             "fillOpacity": 1,
                             "stroke": true,
                             "color": "#000000",
                             "weight": 1,
                             "fillColor": "#0000ff"
                         };
                     case "Fiore":
                         return {
                             "fill": true,
                             "fillOpacity": 1,
                             "stroke": true,
                             "color": "#000000",
                             "weight": 1,
                             "fillColor": "#2CAA40"
                         };
                     case "Unova":
                         return {
                             "fill": true,
                             "fillOpacity": 1,
                             "stroke": true,
                             "color": "#000000",
                             "weight": 1,
                             "fillColor": "#0000ff"
                         };
                     case "Almia":
                         return {
                             "fill": true,
                             "fillOpacity": 1,
                             "stroke": true,
                             "color": "#000000",
                             "weight": 1,
                             "fillColor": "#00ff00"
                         };
                     case "Orre":
                         return {
                             "fill": true,
                             "fillOpacity": 1,
                             "stroke": true,
                             "color": "#000000",
                             "weight": 1,
                             "fillColor": "#ff0000"
                         };
                     case "Oblivia":
                         return {
                             "fill": true,
                             "fillOpacity": 1,
                             "stroke": true,
                             "color": "#000000",
                             "weight": 1,
                             "fillColor": "#ffffff"
                         };
                     default:
                         return {
                             "fill": true,
                             "fillOpacity": 1,
                             "stroke": true,
                             "color": "#000000",
                             "weight": 1,
                             "fillColor": "#555555"
                         };
                 }
             }, //Add features in dictionary layers
             onEachFeature: function(feature, layer) {
                 if(feature.properties.description in regions) {
                     regions[feature.properties.description].addLayer(layer);
                 } else {
                     regions["Rest"].addLayer(layer);
                 }
                 layer.bindPopup(function(layer) {
                     return "<strong> Geographical region <br> " +
                         "Name: \t\t</strong>" + layer.feature.properties.description
                 })
             }
         })
     });

     var pokeball = new PokeIcon({iconUrl: 'pokeball.png'});
     var greatball = new PokeIcon({iconUrl: 'greatball.png'});
     var ultraball = new PokeIcon({iconUrl: 'ultraball.png'});
     var masterball = new PokeIcon({iconUrl: 'masterball.png'});

     jQuery.getJSON("data/cities3.geojson", function (json) {
         L.geoJSON(json, {
             pointToLayer: function (feature, latlng) {
                 var pop = feature.properties.Population;
                 if(pop > 0 && pop < 20) {
                     return L.marker(latlng, {icon: pokeball})
                 } else if (pop >= 20 && pop < 40) {
                     return L.marker(latlng, {icon: greatball})
                 } else if (pop >= 40 && pop < 60) {
                     return L.marker(latlng, {icon: ultraball})
                 } else if (pop >= 60) {
                     return L.marker(latlng, {icon: masterball})
                 }
             },
             onEachFeature: function (feature, layer) {
                 cityLayer.addLayer(layer);
                 layer.bindPopup(function(layer) {
                     return "<strong><u>" + layer.feature.properties.Name + "</strong></u>" +
                         "<br><strong>Region:</strong> " + layer.feature.properties.Region +
                         "<br><strong>Population: </strong>" + layer.feature.properties.Population +
                             "<br><strong>Description: </strong>" + layer.feature.properties.Description
                 })
             }
        });
     });


     function addBackGroundData(feature, layer) {
         backGroundLayer.addLayer(layer);
     }

     var baseMaps = {
         "Pokemon World": backGroundLayer
     };

     var additionalLayers = {
         "Geographical region": politicalLayer,
         "Cities": cityLayer
     };

     L.control.layers(baseMaps, additionalLayers, {collapsed:false}).addTo(map);

     map.on('click', function(e) {
         console.log("Lat: " + e.latlng.lat + "\nLon: " + e.latlng.lng);
     });

     map.on('zoomend', function() {
         console.log("Zoom level: " + map.getZoom());
     });


     /*
      var labelLocation = new L.LatLng(63.366288, 10.4308315);
      var labelTitle = new L.LabelOverlay(labelLocation, '<b>Johto</b>');
      backGroundLayer.addLayer(labelTitle);
      */

     // To prevent the text labels to "jump" when zooming in and out,
     // in Google Chrome, I added this event handler:
     /*
     map.on('movestart', function () {
         map.removeLayer(labelTitle);
         map.removeLayer(labelTitle2);
     });
     map.on('moveend', function () {
         map.addLayer(labelTitle);
         map.addLayer(labelTitle2);
     });
     */
     var dropdown = document.getElementsByClassName("dropDown");

     for (var i = 0; i < dropdown.length; i++) {
         dropdown[i].addEventListener("click", function() {
             this.classList.toggle("active");
             var dropdownContent = this.nextElementSibling;
             if (dropdownContent.style.display === "block") {
                 dropdownContent.style.display = "none";
             } else {
                 dropdownContent.style.display = "block";
             }
         });
     }

     for (var key in regions) {
         var element = document.createElement("OPTION");
         element.innerHTML = key;
         var target = document.getElementsByClassName("dropDownLayers");
         target[0].add(element);
         //document.getElementByName("bufferSelect").appendChild(element);
     }

     function getPokeball(pop) {
         if(pop > 0 && pop < 20) {
             return "<img src=pokeball.png style: {margin: 10px}>";
         } else if (pop >= 20 && pop < 40) {
             return "<img src=greatball.png>";
         } else if (pop >= 40 && pop < 60) {
             return "<img src=ultraball.png>";
         } else if (pop >= 60) {
             return "<img src=masterball.png>";
         }
     }

     var cityLegend = L.control({position: 'bottomright'});

     cityLegend.onAdd = function (map) {

         var div = L.DomUtil.create('div', 'info legend'),
             pop = [0, 20, 40, 60],
             labels = [];

         div.innerHTML += "<strong>Population: </strong><br><br>";
         // loop through our density intervals and generate a icon for each interval
         for (var i = 0; i < pop.length; i++) {
             div.innerHTML +=
                 '' + getPokeball(pop[i] + 1) + "<strong>" +
                 pop[i] + (pop[i + 1] ? '&ndash;' + pop[i + 1] + '<br>' : '+') + "</strong>"
         }

         return div;
     };

     //Add and remove legend when layers are selected or not
     map.on('overlayadd', function(e) {
         if(e.name === "Cities") {
             cityLegend.addTo(map);
         }
     });

     map.on('overlayremove', function (e) {
         if(e.name === "Cities") {
             cityLegend.remove()
         }
     });

 </script>

</body>
</html>